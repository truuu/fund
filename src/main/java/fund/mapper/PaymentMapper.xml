<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
             "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="fund.mapper.PaymentMapper">

    <select id="selectEB21success" resultType="fund.dto.EB21_commitmentDetail">
    	select c.sponsorID,c.ID,e.paymentDate,c.donationPurposeID,c.paymentMethodID
		from EB21_commitmentDetail eb
		JOIN commitmentDetail cd
		ON eb.commitmentDetailID=cd.ID
		JOIN commitment c
		ON cd.commitmentID=c.ID
		JOIN EB21 e ON e.ID=eb.EB21ID
		where eb.state='성공'
    </select>
	
	<insert id="insertEB21Payment" useGeneratedKeys="true" keyProperty="id">
		insert into payment
		(sponsorID,commitmentID,amount,paymentDate,donationPurposeID,paymentMethodID)
		values(3,3,80000,'2016-09-25',1,6)
	</insert>
	
	<insert id="insertAutomationPayment" useGeneratedKeys="true" keyProperty="id">
		insert into payment(sponsorID,commitmentID,amount,paymentDate,paymentMethodID)
		values(1,4,30000,'2016-08-14',7)
	</insert>
	
	<select id="selectIDBySponsorNo" resultType="fund.dto.Sponsor">
		select s.ID,c.ID
		from sponsor s
		JOIN commitment c
		ON s.ID=c.sponsorID
		where s.sponsorNo='2016-0001' AND c.paymentMethodID=8 
	</select>
	
	<insert id="insertSalaryPayment" useGeneratedKeys="true" keyProperty="id">
		insert into payment(sponsorID,commitmentID,amount,paymentDate,donationPurposeID,paymentMethodID)
		values(1,5,30000,'2016-08-20',2,8)
	</insert>
	
	<insert id="insertIrregularPayment" useGeneratedKeys="true" keyProperty="id">
		insert into payment(sponsorID,amount,paymentDate,donationPurposeID,paymentMethodID)
		values(1,900000,'2016-08-27',1,13)
	</insert>
	
	<select id="selectPaymentRegular" resultType="fund.dto.Payment">
		select c.commitmentNo as 약정번호,
		(select code.codeName from code where code.ID=p.paymentMethodID) as 납입방법,
		p.amount as 납입금액,p.paymentDate as 납입일,cd.accountNo as 계좌번호,
		(select code.codeName from code where code.ID=cd.bankID) as 은행,
		cd.accountHolder as 예금주,co.name as 기부기관,dp.name as 기부목적,p.etc as 비고
		from payment p
		JOIN commitment c
		ON p.commitmentID=c.ID
		JOIN commitmentDetail cd
		ON cd.commitmentID=c.ID
		LEFT JOIN code ON code.codeGroup='정기납입방법' AND code.ID=p.paymentMethodID 
		JOIN donationPurpose dp ON c.donationPurposeID=dp.ID
		JOIN corporate co ON dp.corporateID=co.ID
		where p.sponsorID=1	
	</select>
	
	<select id="selectPaymentIrregular" resultType="fund.dto.Payment">
		select code.codeName as 납입방법,p.amount as 납입금액,p.paymentDate as 납입일,co.name as 기부기관,
		dp.name as 기부목적,p.etc as 비고
		from payment p
		JOIN code ON code.codeGroup='비정기납입방법' AND code.ID=p.paymentMethodID
		JOIN donationPurpose dp ON p.donationPurposeID=dp.ID
		JOIN corporate co ON dp.corporateID=co.ID
		where p.sponsorID=1
	</select>
	
	<update id="updatePayment">
		update payment set 수정할 것 
		where ID=선택한payment테이블의id
	</update>
</mapper>
