<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
             "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="fund.mapper.CodeMapper">
	<select id="selectByCodeGroupName" parameterType="String" resultType="fund.dto.Code">
		select c1.*
		from [Code] c1 left join [CodeGroup] c2 on c1.codeGroupID=c2.ID
		where c2.name=#{name} 
	</select>

	<select id="selectByID" parameterType="int" resultType="fund.dto.Code">
		SELECT *
        FROM [Code]
        WHERE ID = #{ID}
	</select>

	<select id="selectCodeGroup"  resultType="fund.dto.CodeGroup"> 
		SELECT *
		FROM [CodeGroup]
	</select>

	<select id="selectByName" resultType="java.lang.String"> 
		SELECT name
		FROM  [CodeGroup] 
		WHERE ID = #{CodeGroupID}
	</select>
	
	<select id="selectByCodeGroupID"  parameterType="hashmap" resultType="fund.dto.Code"> 
		<![CDATA[
		SELECT  *
		FROM  ( SELECT *, ROW_NUMBER() OVER (ORDER BY ID) 행번호
              FROM [Code] 
              WHERE codeGroupID = #{CodeGroupID}
            ) subquery
        WHERE 행번호 > (#{pagination.currentPage} - 1) * #{pagination.pageSize} AND
              행번호 <= #{pagination.currentPage} * #{pagination.pageSize}
        ORDER BY 행번호	
		]]>
	</select>
	
	<select id="selectCount" parameterType="hashmap" resultType="int">
        SELECT COUNT(*)
        FROM [Code]
        WHERE codeGroupID = #{CodeGroupID}
    </select>
	
	<insert id="insert" useGeneratedKeys="true" keyProperty="id">
        INSERT [Code]
               (codeGroupID, codeName, etc1, etc2, etc3)
        VALUES (#{codeGroupID},#{codeName},#{etc1},#{etc2},#{etc3})
	</insert>
	
	<update id="update">
        UPDATE [Code]
        SET codeName = #{codeName}, etc1 = #{etc1}
        WHERE ID = #{ID}
    </update>
	
    <delete id="delete">
        DELETE FROM [Code] WHERE ID = #{ID}
    </delete>

</mapper>
